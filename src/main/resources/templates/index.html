<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" class="h-100">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.css" integrity="sha512-3pIirOrwegjM6erE5gPSwkUzO+3cTjpnV9lexlNZqvupR64iZBnOOTiiLPb9M36zpMScbmUNIcHUqKD47M719g==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <style>
        .btn {
            padding: 14px 26px;
            font-weight: 700;
            font-size: 13px;
            letter-spacing: 1px;
            text-transform: uppercase;
        }
        .btn-danger {
            background-color: #e34c43;
            border-color: #e34c43;
        }

        .banner-image{
            background: linear-gradient(rgba(29, 38, 113, 0.8), rgba(195, 55, 100, 0.8)), url("/img/back.jpg");
            background-size: cover;
            background-position: center;
        }

    </style>
</head>
<body class="d-flex flex-column h-100">
    <main class="flex-shrink-0">
        <div class="banner-image">
            <div class="container pb-5">
                <div class="row py-5 align-items-center">
                    <div class="col-lg-6">
                        <p class="text-white fs-1">
                            Here you have full control over your links.
                        </p>

                        <div class="d-flex">
                            <a href="#short-area" class="btn btn-lg btn-danger mr-2">Go Short!</a>
                        </div>
                    </div>
                    <div class="col-lg-6 text-lg-right text-center mt-5 mt-lg-0">

                    </div>
                </div>
            </div>
        </div>

        <div class="container mt-5">
            <div class="row">
                <div class="col-md-12 col-lg-4">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Url Shorten<i class="fa-solid fa-link ms-2"></i></h5>
                            <h6 class="card-subtitle mb-2 text-muted">Card subtitle</h6>
                            <p class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
                        </div>
                    </div>
                </div>

                <div class="col-md-12 col-lg-4">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">URL Analysis<i class="fa-solid fa-chart-line ms-2"></i></h5>
                            <h6 class="card-subtitle mb-2 text-muted">Card subtitle</h6>
                            <p class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
                        </div>
                    </div>
                </div>

                <div class="col-md-12 col-lg-4">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">URL API<i class="fa-solid fa-code ms-2"></i></h5>
                            <h6 class="card-subtitle mb-2 text-muted">Card subtitle</h6>
                            <p class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <div class="container mt-5 mb-3" id="short-area">
            <div class="input-group">
                <input class="form-control rounded-3 typed" type="url" id="url-input">
                <button class="btn btn-outline-primary rounded-3" id="short-btn">Shorten</button>
            </div>
        </div>

        <div class="container">
            <div class="row" id="result">

            </div>
        </div>

    </main>


    <footer class="bg-dark footer text-center text-white mt-auto">
        <div class="container p-4">
            <section class="mb-4">

                <a class="btn btn-outline-light btn-floating m-1" href="#!" role="button">
                    <i class="fab fa-google"></i>
                </a>

                <a class="btn btn-outline-light btn-floating m-1" href="#!" role="button">
                    <i class="fab fa-github"></i>
                </a>

            </section>

            <section class="mb-4">
                <p>
                    Lorem ipsum dolor sit amet consectetur adipisicing elit. Sunt distinctio earum
                    repellat quaerat voluptatibus placeat nam, commodi optio pariatur est quia magnam
                    eum harum corrupti dicta, aliquam sequi voluptate quas.
                </p>
            </section>
        </div>

        <div class="text-center p-3" style="background-color: rgba(0, 0, 0, 0.2);">
            © 2020 Copyright:
            <a class="text-white" href="">...</a>
        </div>

    </footer>


    <script src="https://kit.fontawesome.com/cea288457b.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/typed.js/2.0.11/typed.min.js"></script>
    <script src="http://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js" integrity="sha512-VEd+nq25CkR676O+pLBnDW09R7VQX9Mdiij052gVCp5yVH3jGtH70Ho/UUv4mJDsEdTvqRCFZg0NKGiojGnUCw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>

        function resultDraw(item) {
            // ITEM(localStorage) : [{...}]
            //TODO : CARD FORM
        }

        window.onstorage = function (e) {
            console.log(e)
        }
        window.addEventListener("load", function () {
            let type = new Typed(".typed", {
                attr: "placeholder",
                strings: ["www.example.com"],
                typeSpeed: 100,
                backSpeed: 40,
                loop: true
            })

            if (!localStorage.getItem("site")) {
                localStorage.setItem("site",JSON.stringify([]))
            }



            document.querySelector("#short-btn").addEventListener("click",() => {
                let urlElem = document.querySelector("#url-input");
                let originUrl = urlElem.value
                const urlRegex = /(http|https):\/\/(\w+:?\w*@)?(\S+)(:\d+)?(\/|\/([\w#!:.?+=&%@\-\/]))?/

                if (!urlRegex.test(originUrl)) {
                    originUrl = "http://" + originUrl
                    if (!urlRegex.test(originUrl)) {
                        alert("올바르지 못한 URL")
                        return
                    }
                }

                fetch("/convert",{
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({originUrl})
                }).then(res => {
                    if (res.status === 200) {
                        return res.json();
                    } else {
                        toastr.error("error")
                    }
                }).then(json => {
                    const parse = JSON.parse(localStorage.getItem("site"));
                    parse.push(json)
                    localStorage.setItem("site",JSON.stringify(parse))
                    urlElem.value = ""
                    toastr.success("success! convert complete")
                }).catch(err => {
                    console.log(err)
                    toastr.error("Convert Fail")
                })
            })
        })
    </script>
</body>
</html>