<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<title>AdminKit Demo - Bootstrap 5 Admin Template</title>

	<link href="../../static/css/app.css" th:href="@{/css/app.css}" rel="stylesheet">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/gridjs/5.0.2/theme/mermaid.min.css" integrity="sha512-QT3siPsD/eTF0b7f9Vq2eHf456XGoqXaiwmqpuIoYwRKnLgpnyntOlebCf/6WtXoXRZV7LupbEdvbgV2Lh0zmA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
	<style>
		@media (min-width: 800px) and (max-width: 850px) {
			.navbar:not(.top-nav-collapse) {
				background: #1C2331!important;
			}
		}

		.navbar{
			background-color: rgba(54, 66, 89, 0);
		}



		@media only screen and (max-width:768px){.navbar{background-color:#1C2331}}
	</style>

</head>

<body>
	<div class="wrapper">


		<div class="main">
			<nav class="navbar navbar-expand-lg navbar-dark w-100">
				<div class="container">

					<!-- Brand -->
					<a class="navbar-brand" href="https://mdbootstrap.com/material-design-for-bootstrap/" target="_blank">
						<strong>Shortest</strong>
					</a>

					<!-- Collapse -->
					<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
							aria-expanded="false" aria-label="Toggle navigation">
						<span class="navbar-toggler-icon"></span>
					</button>

					<!-- Links -->
					<div class="collapse navbar-collapse" id="navbarSupportedContent">

						<!-- Left -->
						<ul class="navbar-nav me-auto">
							<li class="nav-item active">
								<a class="nav-link" href="#">Home</a>
							</li>
							<li class="nav-item">
								<a class="nav-link" href="https://mdbootstrap.com/material-design-for-bootstrap/" target="_blank">About MDB</a>
							</li>
							<li class="nav-item">
								<a class="nav-link" href="https://mdbootstrap.com/getting-started/" target="_blank">Free download</a>
							</li>
						</ul>

						<!-- Right -->
						<ul class="navbar-nav nav-flex-icons">
							<li class="nav-item">
								<a href="https://www.facebook.com/mdbootstrap" class="nav-link" target="_blank">
									<i class="fab fa-facebook-f"></i>
								</a>
							</li>
							<li class="nav-item">
								<a href="https://twitter.com/MDBootstrap" class="nav-link" target="_blank">
									<i class="fab fa-twitter"></i>
								</a>
							</li>
						</ul>

					</div>
				</div>
			</nav>


			<main class="content">
				<div class="container-fluid p-0">

					<h1 class="h3 mb-3"><strong>Analytics</strong> Dashboard</h1>

					<div class="row">
						<div class="col-xl-6 col-xxl-5">
							<div class="w-100">
								<div class="card">
									<div class="card-header">
										<h5 class="card-title mb-0" th:text="${statistics.documentTitle}">${title}</h5>
										<span class="ms-3">${date ~ date} </span>
									</div>
									<div class="card-body">
										<p class="card-text">
											${convertUrl}
											<i class="fa-solid fa-computer-mouse me-2"></i>
											<span th:text="${statistics.hitCount}"></span>
											Click!
										</p>
									</div>
								</div>
							</div>
						</div>

						<div class="col-xl-6 col-xxl-7">
							<div class="card flex-fill w-100">
								<div class="card-header">

									<h5 class="card-title mb-0">date</h5>
								</div>
								<div class="card-body py-3">
									<div class="chart chart-sm">
										<canvas id="date"></canvas>
									</div>
								</div>
							</div>
						</div>
					</div>

					<div class="row">
						<div class="col-12 col-md-6 col-xxl-3 d-flex order-2 order-xxl-3">
							<div class="card flex-fill w-100">
								<div class="card-header">

									<h5 class="card-title mb-0">Browser Usage</h5>
								</div>
								<div class="card-body d-flex">
									<div class="align-self-center w-100">
										<div class="py-3">
											<div class="chart chart-xs">
												<canvas id="browser"></canvas>
											</div>
										</div>

										<table class="table mb-0">
											<tbody>
												<tr th:each="browser: ${statistics.data.browser}">
													<td th:text="${browser.key}"></td>
													<td class="text-end" th:text="${browser.value}"></td>
												</tr>
											</tbody>
										</table>
									</div>
								</div>
							</div>
						</div>
						<div class="col-12 col-md-12 col-xxl-6 d-flex order-3 order-xxl-2">
							<div class="card flex-fill w-100">
								<div class="card-header">

									<h5 class="card-title mb-0">Country</h5>
								</div>
								<div class="card-body px-4">
									<div id="grid"></div>
								</div>
							</div>
						</div>

						<div class="col-12 col-md-6 col-xxl-3 d-flex order-1 order-xxl-1">
							<div class="card flex-fill">
								<div class="card-header">

									<h5 class="card-title mb-0">OS</h5>
								</div>
								<div class="card-body d-flex">
									<div class="align-self-center w-100">
										<div class="chart">
											<canvas id="os"></canvas>
										</div>
										<table class="table mb-0">
											<tbody>
											<tr th:each="os: ${statistics.data.os}">
												<td th:text="${os.key}"></td>
												<td class="text-end" th:text="${os.value}"></td>
											</tr>
											</tbody>
										</table>
									</div>
								</div>
							</div>
						</div>
					</div>

					<div class="row">
						<div class="col-12 col-lg-8 col-xxl-9 d-flex">
							<div class="card flex-fill">
								<div class="card-header">

									<h5 class="card-title mb-0">referer</h5>
								</div>
								<div class="card-body d-flex w-100">
									<div class="align-self-center chart chart-lg">

										<table class="table table-hover my-0">
											<thead>
											<tr>
												<th>Site</th>
												<th>hit</th>
											</tr>
											</thead>
											<tbody>
											<tr th:each="data : ${statistics.data.referer}">
												<th th:text="${data.getKey()}"></th>
												<th th:text="${data.getValue()}"></th>
											</tr>
											</tbody>
										</table>

									</div>
								</div>

							</div>
						</div>
						<div class="col-12 col-lg-4 col-xxl-3 d-flex">
							<div class="card flex-fill w-100">
								<div class="card-header">

									<h5 class="card-title mb-0">Device</h5>
								</div>
								<div class="card-body d-flex w-100">
									<div class="align-self-center chart chart-lg">
										<canvas id="device"></canvas>
										<table class="table mb-0">
											<tbody>
											<tr th:each="device: ${statistics.data.device}">
												<td th:text="${device.key}"></td>
												<td class="text-end" th:text="${device.value}"></td>
											</tr>
											</tbody>
										</table>
									</div>
								</div>
							</div>
						</div>
					</div>

				</div>
			</main>


			<footer class="bg-dark footer text-center text-white mt-auto">
				<div class="container p-4">
					<section class="mb-1">
						<a class="btn btn-outline-light btn-floating m-1" href="#!" role="button">
							<i class="fab fa-google"></i>
						</a>
						<a class="btn btn-outline-light btn-floating m-1" href="#!" role="button">
							<i class="fab fa-github"></i>
						</a>
					</section>
				</div>

				<div class="text-center" style="background-color: rgba(0, 0, 0, 0.2);">
					© 2022 Copyright:
					<a class="text-white" href="">...</a>
				</div>

			</footer>
		</div>
	</div>

	<script src="../../static/js/app.js" th:src="@{/js/app.js}"></script>
	<script crossorigin="anonymous" src="https://kit.fontawesome.com/cea288457b.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-autocolors"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/gridjs/5.0.2/gridjs.production.min.js" integrity="sha512-Tv3f/y9wnNx+aH5FkA/kqiHSTIz6F8VZA/thVKMzzrCHzzpsBhxmXcHdrgzDkGv9AV4yKh7F6m8PJV/wUjRkyQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	<script th:inline="javascript">

		const autocolors = window['chartjs-plugin-autocolors'];
		Chart.register(autocolors);

		function makeChart(data,ctx,type) {
			const {key, value} = data // {key:[], value:[]}

			const chartSetting = {
				type: type, // 차트의 형태
				data: { // 차트에 들어갈 데이터
					labels: [
						//x 축
						...key
					],
					datasets: [
						{ //데이터
							label: 'count', //차트 제목
							fill: false, // line 형태일 때, 선 안쪽을 채우는지 안채우는지
							data: [
								...value //x축 label에 대응되는 데이터 값
							],
							borderWidth: 1 //경계선 굵기
						}
					]
				},
				options: {
					plugins: {
						autocolors: {
							mode: 'data'
						}
					}
				}
			}
			new Chart(ctx, chartSetting)
		}

		const {data} = [[${statistics}]];

		document.querySelectorAll("canvas").forEach(elem => {
			let type;

			switch (elem.id) {
				case "date":
					type = "line"
					break
				case "browser":
					type = "pie"
					break
				case "os":
					type = "doughnut"
					break
				default:
					type = "doughnut"
					break
			}

			makeChart(
					{
						key:Object.keys(data[elem.id]),
						value:Object.values(data[elem.id])
					},
					elem.getContext("2d"),
					type)
		})

		new gridjs.Grid({
			sort: true,
			search: true,
			pagination: {
				limit:10,
			},
			columns:['country','hit'],
			data:[
					...Object.keys(data['country']).map(s => [s, data['country'][s]])
			]
		}).render(document.getElementById("grid"))

	</script>


</body>

</html>